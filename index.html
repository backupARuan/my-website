<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜¿é˜®æªåœ˜è³¼</title>
    <!-- å¼•å…¥ Google Fonts: Noto Sans TC æä¾›æ›´æœ‰è³ªæ„Ÿçš„ç¹é«”ä¸­æ–‡é¡¯ç¤º -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- å¼•å…¥ Tailwind CSS å¿«é€Ÿæ§‹å»ºç¾ä»£åŒ–æ¨£å¼ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9', // ä¸»è‰²èª¿ï¼šæ¸…æ–°çš„å¤©è—
                            600: '#0284c7',
                            900: '#0c4a6e',
                        },
                        accent: {
                            light: '#fdba74',
                            DEFAULT: '#f97316', // å¼·èª¿è‰²ï¼šè³ªæ„Ÿæ©˜ (ç”¨æ–¼åƒ¹æ ¼)
                        }
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)', // è‡ªå®šç¾©æŸ”å’Œé™°å½±
                    }
                }
            }
        }
    </script>
    <style>
        /* å¢åŠ å¾®ç´°çš„èƒŒæ™¯å™ªé»è³ªæ„Ÿ */
        body {
            background-color: #f8fafc;
            background-image: 
                radial-gradient(at 0% 0%, rgba(255, 255, 255, 0.8) 0px, transparent 50%), 
                radial-gradient(at 100% 0%, rgba(224, 242, 254, 0.4) 0px, transparent 50%);
        }
        
        /* è‡ªå®šç¾©å¡ç‰‡æ‡¸æµ®å‹•ç•« */
        .item-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.08), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
        }
    </style>
</head>
<body class="text-slate-600 font-sans min-h-screen p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        
        <!-- é é¦–å€åŸŸ -->
        <header class="text-center mb-10 mt-4 relative">
            <div class="inline-block relative">
                <h1 class="text-3xl sm:text-4xl font-bold text-slate-800 tracking-tight mb-2">
                    é˜¿é˜®æªåœ˜è³¼
                </h1>
                <!-- è£é£¾æ€§ä¸‹åº•ç·š -->
                <div class="h-1 w-1/2 bg-brand-500 mx-auto rounded-full opacity-80"></div>
            </div>
            <p class="text-slate-400 mt-3 text-sm font-light tracking-wide">
                ç²¾é¸å¥½ç‰©ãƒ»é™æ™‚è·Ÿåœ˜ãƒ»éŒ¯éä¸å†
            </p>
        </header>

        <!-- åˆ—è¡¨å®¹å™¨ -->
        <main class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-soft border border-white/50 overflow-hidden">
            
            <!-- è¡¨é ­ (åƒ…åœ¨æ¡Œæ©Ÿç‰ˆé¡¯ç¤º) -->
            <div class="hidden sm:grid grid-cols-12 gap-4 p-5 bg-slate-50/80 border-b border-slate-100 text-sm font-medium text-slate-500 uppercase tracking-wider">
                <div class="col-span-6 pl-2">å•†å“åç¨±</div>
                <div class="col-span-3 text-right pr-4">åƒ¹æ ¼</div>
                <div class="col-span-3 text-center">æ”¶å–®æ—¥æœŸ</div>
            </div>

            <!-- åˆ—è¡¨å…§å®¹ (å‹•æ…‹ç”Ÿæˆ) -->
            <div id="product-list" class="divide-y divide-slate-100">
                <!-- JavaScript å°‡åœ¨æ­¤è™•æ’å…¥å…§å®¹ -->
            </div>
            
        </main>

        <footer class="text-center mt-12 text-slate-400 text-xs">
            Â© 2025 é˜¿é˜®æªåœ˜è³¼. All rights reserved.
        </footer>


        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // âš ï¸ è«‹å¡«å…¥ä½ çš„ Google Apps Script ç¶²å€
                const API_URL = 'https://script.google.com/macros/s/AKfycbzYCHG1ugr7gzciLeMnc-hLy8PUXF7qPWhJfR1vXBS0wUqrQrJWCWdJdFMdOso8la5p8A/exec';

                const listContainer = document.getElementById('product-list');

                // é¡¯ç¤ºè¼‰å…¥ä¸­
                listContainer.innerHTML = `
                        <div class="p-10 text-center text-slate-400">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-brand-500 mb-2"></div>
                            <p>æ­£åœ¨å°‹æ‰¾å¥½ç‰©...</p>
                        </div>
                    `;

                fetch(API_URL)
                    .then(response => response.json())
                    .then(data => {
                        renderProducts(data);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        listContainer.innerHTML = `<div class="p-10 text-center text-red-400">è®€å–è³‡æ–™å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</div>`;
                    });

                // --- ğŸ› ï¸ æ ¸å¿ƒä¿®æ”¹ï¼šè¬èƒ½æ—¥æœŸè§£æå‡½å¼ ---
                function parseSmartDate(dateInput) {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const currentYear = today.getFullYear();

                    let targetDate;
                    let displayStr = "";

                    // æƒ…æ³ 1: å¦‚æœæ˜¯æ¨™æº–æ™‚é–“æ ¼å¼ (ä¾‹å¦‚ Google Sheet çš„æ—¥æœŸæ ¼å¼)
                    // åˆ¤æ–·æ–¹å¼ï¼šæ˜¯å­—ä¸²ä¸”åŒ…å« "-" æˆ– "T"ï¼Œæˆ–è€…åŸæœ¬å°±æ˜¯ Date ç‰©ä»¶
                    if (dateInput && (typeof dateInput === 'string' && (dateInput.includes('-') || dateInput.includes('T')))) {
                        targetDate = new Date(dateInput);
                        // æ ¼å¼åŒ–é¡¯ç¤ºæ–‡å­—ç‚º "12/30"
                        const m = (targetDate.getMonth() + 1).toString().padStart(2, '0');
                        const d = targetDate.getDate().toString().padStart(2, '0');
                        displayStr = `${m}/${d}`;
                    }
                    // æƒ…æ³ 2: å¦‚æœæ˜¯æ‰‹æ‰“çš„ "12/30" (ç´”æ–‡å­—æ ¼å¼)
                    else if (typeof dateInput === 'string' && dateInput.includes('/')) {
                        const parts = dateInput.split('/');
                        const month = parseInt(parts[0], 10) - 1;
                        const day = parseInt(parts[1], 10);
                        targetDate = new Date(currentYear, month, day);

                        // è·¨å¹´é‚è¼¯ï¼šå¦‚æœä»Šå¤©æ˜¯12æœˆï¼Œå•†å“æ˜¯1æœˆï¼Œè¦–ç‚ºæ˜å¹´
                        if (today.getMonth() === 11 && month === 0) {
                            targetDate.setFullYear(currentYear + 1);
                        }
                        displayStr = dateInput; // ç¶­æŒåŸæœ¬è¼¸å…¥
                    }
                    // æƒ…æ³ 3: è³‡æ–™éŒ¯èª¤æˆ–ç©ºç™½
                    else {
                        // çµ¦ä¸€å€‹å¾ˆä¹…ä»¥å¾Œçš„æ—¥æœŸï¼Œé¿å…å ±éŒ¯
                        targetDate = new Date(2999, 0, 1);
                        displayStr = "ç„¡æœŸé™";
                    }

                    return {
                        obj: targetDate,   // ç”¨ä¾†è¨ˆç®—å€’æ•¸èˆ‡æ’åº
                        text: displayStr   // ç”¨ä¾†é¡¯ç¤ºåœ¨ç•«é¢ä¸Š (MM/DD)
                    };
                }
                // ----------------------------------------

                function renderProducts(products) {
                    listContainer.innerHTML = '';

                    if (!Array.isArray(products) || products.length === 0) {
                        listContainer.innerHTML = `<div class="p-10 text-center text-slate-400">ç›®å‰æ²’æœ‰åœ˜è³¼å•†å“ã€‚</div>`;
                        return;
                    }

                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    // æ’åºé‚è¼¯ (ä½¿ç”¨æ–°çš„è§£æå‡½å¼)
                    products.sort((a, b) => {
                        const dateA = parseSmartDate(a.date).obj;
                        const dateB = parseSmartDate(b.date).obj;
                        return dateA - dateB;
                    });

                    products.forEach(product => {
                        const priceStr = product.price ? String(product.price).replace('$', 'NT$ ') : 'NT$ --';
                        const nameStr = product.name || 'æœªå‘½åå•†å“';
                        const linkStr = product.link || '#';

                        // ä½¿ç”¨æ–°çš„è§£æå‡½å¼è™•ç†æ—¥æœŸ
                        const dateInfo = parseSmartDate(product.date);
                        const productDate = dateInfo.obj;
                        const dateDisplay = dateInfo.text;

                        // è¨ˆç®—å€’æ•¸å¤©æ•¸
                        const diffTime = productDate - today;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                        // å¦‚æœå·²éæœŸï¼ˆdiffDays < 0ï¼‰ï¼Œå‰‡è·³éä¸é¡¯ç¤º
                        if (diffDays < 0) {
                            return; // ç­‰åŒæ–¼ continueï¼Œè·³éæ­¤ç­†å•†å“
                        }

                        let dateBadgeHtml = '';

                        if (diffDays > 0 && diffDays <= 3) {
                            dateBadgeHtml = `
                                    <div class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-50 text-red-600 border border-red-100">
                                        <svg class="w-3 h-3 mr-1.5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                        å‰© ${diffDays} å¤©
                                    </div>`;
                        } else if (diffDays === 0) {
                            dateBadgeHtml = `
                                    <div class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-50 text-red-600 border border-red-100">
                                        <svg class="w-3 h-3 mr-1.5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                        ä»Šæ—¥æ”¶å–®
                                    </div>`;
                        } else {
                            dateBadgeHtml = `
                                    <div class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-600 border border-slate-200">
                                        <svg class="w-3 h-3 mr-1.5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                        ${dateDisplay} æ”¶å–®
                                    </div>`;
                        }

                        const itemHtml = `
                                <a href="${linkStr}" target="_blank" class="block item-card group sm:grid sm:grid-cols-12 sm:gap-4 p-5 items-center bg-white hover:bg-slate-50/50 cursor-pointer no-underline">
                                    <div class="col-span-6 mb-3 sm:mb-0 flex items-start sm:items-center gap-3">
                                        <div>
                                            <h3 class="text-lg font-bold text-slate-700 group-hover:text-brand-600 transition-colors">
                                                ${nameStr}
                                            </h3>
                                        </div>
                                    </div>
                                    <div class="col-span-3 mb-2 sm:mb-0 flex justify-between sm:justify-end sm:pr-4 items-center">
                                        <span class="text-xs text-slate-400 sm:hidden">åœ˜è³¼åƒ¹</span>
                                        <span class="text-lg font-bold text-accent font-mono tracking-tight">${priceStr}</span>
                                    </div>
                                    <div class="col-span-3 flex justify-between sm:justify-center items-center">
                                        <span class="text-xs text-slate-400 sm:hidden">æˆªæ­¢æ—¥</span>
                                        ${dateBadgeHtml}
                                    </div>
                                </a>
                            `;
                        listContainer.insertAdjacentHTML('beforeend', itemHtml);
                    });
                }
            });
        </script>
    </div>

</body>

</html>